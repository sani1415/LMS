<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LMS CRUD Operations Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            border: 1px solid #ddd;
            margin: 20px 0;
            padding: 20px;
            border-radius: 5px;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .test-button.danger {
            background: #dc3545;
        }
        .test-button.danger:hover {
            background: #c82333;
        }
        .test-button.success {
            background: #28a745;
        }
        .test-button.success:hover {
            background: #218838;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            background: #f8f9fa;
            border-left: 4px solid #007bff;
        }
        .error {
            border-left-color: #dc3545;
            background: #f8d7da;
        }
        .success {
            border-left-color: #28a745;
            background: #d4edda;
        }
        .warning {
            border-left-color: #ffc107;
            background: #fff3cd;
        }
        .status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 15px;
            border-radius: 5px;
            color: white;
            font-weight: bold;
        }
        .status.connected {
            background-color: #28a745;
        }
        .status.disconnected {
            background-color: #dc3545;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .test-item {
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 5px;
            background: #f9f9f9;
        }
    </style>
</head>
<body>
    <h1>Library Management System - CRUD Operations Test</h1>
    
    <div id="api-status" class="status disconnected">API Status: Disconnected</div>
    
    <div class="test-section">
        <h2>üîç Connection Test</h2>
        <p>First, verify your Flask backend is running and accessible</p>
        <button class="test-button" onclick="testConnection()">Test API Connection</button>
        <div id="connection-result"></div>
    </div>

    <div class="test-section">
        <h2>üìö Books CRUD Operations</h2>
        <div class="test-grid">
            <div class="test-item">
                <h3>Create (Add Book)</h3>
                <button class="test-button success" onclick="testAddBook()">Test Add Book</button>
                <div id="add-book-result"></div>
            </div>
            <div class="test-item">
                <h3>Read (Get Books)</h3>
                <button class="test-button" onclick="testGetBooks()">Test Get Books</button>
                <div id="get-books-result"></div>
            </div>
            <div class="test-item">
                <h3>Update (Edit Book)</h3>
                <button class="test-button" onclick="testEditBook()">Test Edit Book</button>
                <div id="edit-book-result"></div>
            </div>
            <div class="test-item">
                <h3>Delete (Remove Book)</h3>
                <button class="test-button danger" onclick="testDeleteBook()">Test Delete Book</button>
                <div id="delete-book-result"></div>
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2>üë• Members CRUD Operations</h2>
        <div class="test-grid">
            <div class="test-item">
                <h3>Create (Add Member)</h3>
                <button class="test-button success" onclick="testAddMember()">Test Add Member</button>
                <div id="add-member-result"></div>
            </div>
            <div class="test-item">
                <h3>Read (Get Members)</h3>
                <button class="test-button" onclick="testGetMembers()">Test Get Members</button>
                <div id="get-members-result"></div>
            </div>
            <div class="test-item">
                <h3>Update (Edit Member)</h3>
                <button class="test-button" onclick="testEditMember()">Test Edit Member</button>
                <div id="edit-member-result"></div>
            </div>
            <div class="test-item">
                <h3>Delete (Remove Member)</h3>
                <button class="test-button danger" onclick="testDeleteMember()">Test Delete Member</button>
                <div id="delete-member-result"></div>
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2>üè∑Ô∏è Categories CRUD Operations</h2>
        <div class="test-grid">
            <div class="test-item">
                <h3>Create (Add Category)</h3>
                <button class="test-button success" onclick="testAddCategory()">Test Add Category</button>
                <div id="add-category-result"></div>
            </div>
            <div class="test-item">
                <h3>Read (Get Categories)</h3>
                <button class="test-button" onclick="testGetCategories()">Test Get Categories</button>
                <div id="get-categories-result"></div>
            </div>
            <div class="test-item">
                <h3>Update (Edit Category)</h3>
                <button class="test-button" onclick="testEditCategory()">Test Edit Category</button>
                <div id="edit-category-result"></div>
            </div>
            <div class="test-item">
                <h3>Delete (Remove Category)</h3>
                <button class="test-button danger" onclick="testDeleteCategory()">Test Delete Category</button>
                <div id="delete-category-result"></div>
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2>üè¢ Publishers CRUD Operations</h2>
        <div class="test-grid">
            <div class="test-item">
                <h3>Create (Add Publisher)</h3>
                <button class="test-button success" onclick="testAddPublisher()">Test Add Publisher</button>
                <div id="add-publisher-result"></div>
            </div>
            <div class="test-item">
                <h3>Read (Get Publishers)</h3>
                <button class="test-button" onclick="testGetPublishers()">Test Get Publishers</button>
                <div id="get-publishers-result"></div>
            </div>
            <div class="test-item">
                <h3>Update (Edit Publisher)</h3>
                <button class="test-button" onclick="testEditPublisher()">Test Edit Publisher</button>
                <div id="edit-publisher-result"></div>
            </div>
            <div class="test-item">
                <h3>Delete (Remove Publisher)</h3>
                <button class="test-button danger" onclick="testDeletePublisher()">Test Delete Publisher</button>
                <div id="delete-publisher-result"></div>
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2>üìù Library Log Operations</h2>
        <div class="test-grid">
            <div class="test-item">
                <h3>Create (Add Log)</h3>
                <button class="test-button success" onclick="testAddLog()">Test Add Log</button>
                <div id="add-log-result"></div>
            </div>
            <div class="test-item">
                <h3>Read (Get Logs)</h3>
                <button class="test-button" onclick="testGetLogs()">Test Get Logs</button>
                <div id="get-logs-result"></div>
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2>üéØ Complete CRUD Test</h2>
        <p>Test all CRUD operations in sequence to verify everything works</p>
        <button class="test-button success" onclick="testCompleteCRUD()">Run Complete CRUD Test</button>
        <div id="complete-crud-result"></div>
    </div>

    <script>
        const API_BASE = '/api';
        let testData = {
            book: null,
            member: null,
            category: null,
            publisher: null
        };
        
        function updateStatus(connected) {
            const status = document.getElementById('api-status');
            status.className = `status ${connected ? 'connected' : 'disconnected'}`;
            status.textContent = `API Status: ${connected ? 'Connected' : 'Disconnected'}`;
        }

        function showResult(elementId, message, isError = false, isSuccess = false, isWarning = false) {
            const element = document.getElementById(elementId);
            element.className = `result ${isError ? 'error' : ''} ${isSuccess ? 'success' : ''} ${isWarning ? 'warning' : ''}`;
            element.innerHTML = message;
        }

        async function apiCall(endpoint, options = {}) {
            const url = `${API_BASE}${endpoint}`;
            const defaultOptions = {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                },
                ...options
            };

            try {
                const response = await fetch(url, defaultOptions);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                updateStatus(true);
                return await response.json();
            } catch (error) {
                updateStatus(false);
                throw error;
            }
        }

        // Connection Test
        async function testConnection() {
            try {
                const result = await apiCall('/health');
                showResult('connection-result', 
                    `<strong>‚úÖ Connection Successful!</strong><br>
                     Status: ${result.status}<br>
                     Message: ${result.message}`, 
                    false, true);
            } catch (error) {
                showResult('connection-result', 
                    `<strong>‚ùå Connection Failed!</strong><br>
                     Error: ${error.message}`, 
                    true);
            }
        }

        // Books CRUD Tests
        async function testAddBook() {
            try {
                const newBook = {
                    bookName: 'Test Book ' + Date.now(),
                    author: 'Test Author',
                    category: 'Fiction',
                    volumes: 1,
                    year: 2024,
                    note: 'Test book for CRUD testing'
                };

                const result = await apiCall('/books', {
                    method: 'POST',
                    body: JSON.stringify(newBook)
                });

                testData.book = result;
                showResult('add-book-result', 
                    `<strong>‚úÖ Book Added Successfully!</strong><br>
                     ID: ${result.id}<br>
                     Name: ${result.bookName}<br>
                     Author: ${result.author}`, 
                    false, true);
            } catch (error) {
                showResult('add-book-result', 
                    `<strong>‚ùå Add Book Failed!</strong><br>
                     Error: ${error.message}`, 
                    true);
            }
        }

        async function testGetBooks() {
            try {
                const result = await apiCall('/books');
                showResult('get-books-result', 
                    `<strong>‚úÖ Books Retrieved Successfully!</strong><br>
                     Total Books: ${result.total}<br>
                     Books on Page: ${result.books.length}`, 
                    false, true);
            } catch (error) {
                showResult('get-books-result', 
                    `<strong>‚ùå Get Books Failed!</strong><br>
                     Error: ${error.message}`, 
                    true);
            }
        }

        async function testEditBook() {
            if (!testData.book) {
                showResult('edit-book-result', 
                    `<strong>‚ö†Ô∏è No Book to Edit!</strong><br>
                     Add a book first using the "Test Add Book" button`, 
                    false, false, true);
                return;
            }

            try {
                const updatedBook = {
                    bookName: 'Updated Book ' + Date.now(),
                    author: 'Updated Author'
                };

                const result = await apiCall(`/books/${testData.book.id}`, {
                    method: 'PUT',
                    body: JSON.stringify(updatedBook)
                });

                testData.book = result;
                showResult('edit-book-result', 
                    `<strong>‚úÖ Book Updated Successfully!</strong><br>
                     New Name: ${result.bookName}<br>
                     New Author: ${result.author}`, 
                    false, true);
            } catch (error) {
                showResult('edit-book-result', 
                    `<strong>‚ùå Edit Book Failed!</strong><br>
                     Error: ${error.message}`, 
                    true);
            }
        }

        async function testDeleteBook() {
            if (!testData.book) {
                showResult('delete-book-result', 
                    `<strong>‚ö†Ô∏è No Book to Delete!</strong><br>
                     Add a book first using the "Test Add Book" button`, 
                    false, false, true);
                return;
            }

            try {
                await apiCall(`/books/${testData.book.id}`, {
                    method: 'DELETE'
                });

                showResult('delete-book-result', 
                    `<strong>‚úÖ Book Deleted Successfully!</strong><br>
                     Book "${testData.book.bookName}" has been removed`, 
                    false, true);
                
                testData.book = null;
            } catch (error) {
                showResult('delete-book-result', 
                    `<strong>‚ùå Delete Book Failed!</strong><br>
                     Error: ${error.message}`, 
                    true);
            }
        }

        // Members CRUD Tests
        async function testAddMember() {
            try {
                const newMember = {
                    name: 'Test Member ' + Date.now(),
                    email: 'test@example.com',
                    phone: '123-456-7890',
                    address: 'Test Address'
                };

                const result = await apiCall('/members', {
                    method: 'POST',
                    body: JSON.stringify(newMember)
                });

                testData.member = result;
                showResult('add-member-result', 
                    `<strong>‚úÖ Member Added Successfully!</strong><br>
                     ID: ${result.id}<br>
                     Name: ${result.name}<br>
                     Email: ${result.email}`, 
                    false, true);
            } catch (error) {
                showResult('add-member-result', 
                    `<strong>‚ùå Add Member Failed!</strong><br>
                     Error: ${error.message}`, 
                    true);
            }
        }

        async function testGetMembers() {
            try {
                const result = await apiCall('/members');
                showResult('get-members-result', 
                    `<strong>‚úÖ Members Retrieved Successfully!</strong><br>
                     Total Members: ${result.length}`, 
                    false, true);
            } catch (error) {
                showResult('get-members-result', 
                    `<strong>‚ùå Get Members Failed!</strong><br>
                     Error: ${error.message}`, 
                    true);
            }
        }

        async function testEditMember() {
            if (!testData.member) {
                showResult('edit-member-result', 
                    `<strong>‚ö†Ô∏è No Member to Edit!</strong><br>
                     Add a member first using the "Test Add Member" button`, 
                    false, false, true);
                return;
            }

            try {
                const updatedMember = {
                    name: 'Updated Member ' + Date.now(),
                    email: 'updated@example.com'
                };

                const result = await apiCall(`/members/${testData.member.id}`, {
                    method: 'PUT',
                    body: JSON.stringify(updatedMember)
                });

                testData.member = result;
                showResult('edit-member-result', 
                    `<strong>‚úÖ Member Updated Successfully!</strong><br>
                     New Name: ${result.name}<br>
                     New Email: ${result.email}`, 
                    false, true);
            } catch (error) {
                showResult('edit-member-result', 
                    `<strong>‚ùå Edit Member Failed!</strong><br>
                     Error: ${error.message}`, 
                    true);
            }
        }

        async function testDeleteMember() {
            if (!testData.member) {
                showResult('delete-member-result', 
                    `<strong>‚ö†Ô∏è No Member to Delete!</strong><br>
                     Add a member first using the "Test Add Member" button`, 
                    false, false, true);
                return;
            }

            try {
                await apiCall(`/members/${testData.member.id}`, {
                    method: 'DELETE'
                });

                showResult('delete-member-result', 
                    `<strong>‚úÖ Member Deleted Successfully!</strong><br>
                     Member "${testData.member.name}" has been removed`, 
                    false, true);
                
                testData.member = null;
            } catch (error) {
                showResult('delete-member-result', 
                    `<strong>‚ùå Delete Member Failed!</strong><br>
                     Error: ${error.message}`, 
                    true);
            }
        }

        // Categories CRUD Tests
        async function testAddCategory() {
            try {
                const newCategory = {
                    name: 'Test Category ' + Date.now(),
                    description: 'Test category for CRUD testing'
                };

                const result = await apiCall('/categories', {
                    method: 'POST',
                    body: JSON.stringify(newCategory)
                });

                testData.category = result;
                showResult('add-category-result', 
                    `<strong>‚úÖ Category Added Successfully!</strong><br>
                     ID: ${result.id}<br>
                     Name: ${result.name}`, 
                    false, true);
            } catch (error) {
                showResult('add-category-result', 
                    `<strong>‚ùå Add Category Failed!</strong><br>
                     Error: ${error.message}`, 
                    true);
            }
        }

        async function testGetCategories() {
            try {
                const result = await apiCall('/categories');
                showResult('get-categories-result', 
                    `<strong>‚úÖ Categories Retrieved Successfully!</strong><br>
                     Total Categories: ${result.length}`, 
                    false, true);
            } catch (error) {
                showResult('get-categories-result', 
                    `<strong>‚ùå Get Categories Failed!</strong><br>
                     Error: ${error.message}`, 
                    true);
            }
        }

        async function testEditCategory() {
            if (!testData.category) {
                showResult('edit-category-result', 
                    `<strong>‚ö†Ô∏è No Category to Edit!</strong><br>
                     Add a category first using the "Test Add Category" button`, 
                    false, false, true);
                return;
            }

            try {
                const updatedCategory = {
                    name: 'Updated Category ' + Date.now(),
                    description: 'Updated description'
                };

                const result = await apiCall(`/categories/${testData.category.id}`, {
                    method: 'PUT',
                    body: JSON.stringify(updatedCategory)
                });

                testData.category = result;
                showResult('edit-category-result', 
                    `<strong>‚úÖ Category Updated Successfully!</strong><br>
                     New Name: ${result.name}`, 
                    false, true);
            } catch (error) {
                showResult('edit-category-result', 
                    `<strong>‚ùå Edit Category Failed!</strong><br>
                     Error: ${error.message}`, 
                    true);
            }
        }

        async function testDeleteCategory() {
            if (!testData.category) {
                showResult('delete-category-result', 
                    `<strong>‚ö†Ô∏è No Category to Delete!</strong><br>
                     Add a category first using the "Test Add Category" button`, 
                    false, false, true);
                return;
            }

            try {
                await apiCall(`/categories/${testData.category.id}`, {
                    method: 'DELETE'
                });

                showResult('delete-category-result', 
                    `<strong>‚úÖ Category Deleted Successfully!</strong><br>
                     Category "${testData.category.name}" has been removed`, 
                    false, true);
                
                testData.category = null;
            } catch (error) {
                showResult('delete-category-result', 
                    `<strong>‚ùå Delete Category Failed!</strong><br>
                     Error: ${error.message}`, 
                    true);
            }
        }

        // Publishers CRUD Tests
        async function testAddPublisher() {
            try {
                const newPublisher = {
                    name: 'Test Publisher ' + Date.now(),
                    address: 'Test Address',
                    contact_info: 'Test Contact'
                };

                const result = await apiCall('/publishers', {
                    method: 'POST',
                    body: JSON.stringify(newPublisher)
                });

                testData.publisher = result;
                showResult('add-publisher-result', 
                    `<strong>‚úÖ Publisher Added Successfully!</strong><br>
                     ID: ${result.id}<br>
                     Name: ${result.name}`, 
                    false, true);
            } catch (error) {
                showResult('add-publisher-result', 
                    `<strong>‚ùå Add Publisher Failed!</strong><br>
                     Error: ${error.message}`, 
                    true);
            }
        }

        async function testGetPublishers() {
            try {
                const result = await apiCall('/publishers');
                showResult('get-publishers-result', 
                    `<strong>‚úÖ Publishers Retrieved Successfully!</strong><br>
                     Total Publishers: ${result.length}`, 
                    false, true);
            } catch (error) {
                showResult('get-publishers-result', 
                    `<strong>‚ùå Get Publishers Failed!</strong><br>
                     Error: ${error.message}`, 
                    true);
            }
        }

        async function testEditPublisher() {
            if (!testData.publisher) {
                showResult('edit-publisher-result', 
                    `<strong>‚ö†Ô∏è No Publisher to Edit!</strong><br>
                     Add a publisher first using the "Test Add Publisher" button`, 
                    false, false, true);
                return;
            }

            try {
                const updatedPublisher = {
                    name: 'Updated Publisher ' + Date.now(),
                    address: 'Updated Address'
                };

                const result = await apiCall(`/publishers/${testData.publisher.id}`, {
                    method: 'PUT',
                    body: JSON.stringify(updatedPublisher)
                });

                testData.publisher = result;
                showResult('edit-publisher-result', 
                    `<strong>‚úÖ Publisher Updated Successfully!</strong><br>
                     New Name: ${result.name}`, 
                    false, true);
            } catch (error) {
                showResult('edit-publisher-result', 
                    `<strong>‚ùå Edit Publisher Failed!</strong><br>
                     Error: ${error.message}`, 
                    true);
            }
        }

        async function testDeletePublisher() {
            if (!testData.publisher) {
                showResult('delete-publisher-result', 
                    `<strong>‚ö†Ô∏è No Publisher to Delete!</strong><br>
                     Add a publisher first using the "Test Add Publisher" button`, 
                    false, false, true);
                return;
            }

            try {
                await apiCall(`/publishers/${testData.publisher.id}`, {
                    method: 'DELETE'
                });

                showResult('delete-publisher-result', 
                    `<strong>‚úÖ Publisher Deleted Successfully!</strong><br>
                     Publisher "${testData.publisher.name}" has been removed`, 
                    false, true);
                
                testData.publisher = null;
            } catch (error) {
                showResult('delete-publisher-result', 
                    `<strong>‚ùå Delete Publisher Failed!</strong><br>
                     Error: ${error.message}`, 
                    true);
            }
        }

        // Library Log Tests
        async function testAddLog() {
            try {
                const newLog = {
                    content: 'Test log entry ' + Date.now(),
                    log_type: 'Test'
                };

                const result = await apiCall('/library-log', {
                    method: 'POST',
                    body: JSON.stringify(newLog)
                });

                showResult('add-log-result', 
                    `<strong>‚úÖ Log Added Successfully!</strong><br>
                     ID: ${result.id}<br>
                     Content: ${result.content}`, 
                    false, true);
            } catch (error) {
                showResult('add-log-result', 
                    `<strong>‚ùå Add Log Failed!</strong><br>
                     Error: ${error.message}`, 
                    true);
            }
        }

        async function testGetLogs() {
            try {
                const result = await apiCall('/library-log');
                showResult('get-logs-result', 
                    `<strong>‚úÖ Logs Retrieved Successfully!</strong><br>
                     Total Logs: ${result.total}`, 
                    false, true);
            } catch (error) {
                showResult('get-logs-result', 
                    `<strong>‚ùå Get Logs Failed!</strong><br>
                     Error: ${error.message}`, 
                    true);
            }
        }

        // Complete CRUD Test
        async function testCompleteCRUD() {
            const results = [];
            
            try {
                showResult('complete-crud-result', '<strong>üîÑ Running Complete CRUD Test...</strong>');
                
                // Test all operations in sequence
                const tests = [
                    { name: 'Connection', func: testConnection },
                    { name: 'Add Book', func: testAddBook },
                    { name: 'Get Books', func: testGetBooks },
                    { name: 'Edit Book', func: testEditBook },
                    { name: 'Delete Book', func: testDeleteBook },
                    { name: 'Add Member', func: testAddMember },
                    { name: 'Get Members', func: testGetMembers },
                    { name: 'Edit Member', func: testEditMember },
                    { name: 'Delete Member', func: testDeleteMember },
                    { name: 'Add Category', func: testAddCategory },
                    { name: 'Get Categories', func: testGetCategories },
                    { name: 'Edit Category', func: testEditCategory },
                    { name: 'Delete Category', func: testDeleteCategory },
                    { name: 'Add Publisher', func: testAddPublisher },
                    { name: 'Get Publishers', func: testGetPublishers },
                    { name: 'Edit Publisher', func: testEditPublisher },
                    { name: 'Delete Publisher', func: testDeletePublisher },
                    { name: 'Add Log', func: testAddLog },
                    { name: 'Get Logs', func: testGetLogs }
                ];

                for (const test of tests) {
                    try {
                        await test.func();
                        results.push({ name: test.name, status: '‚úÖ PASS' });
                    } catch (error) {
                        results.push({ name: test.name, status: '‚ùå FAIL', error: error.message });
                    }
                }

                const passed = results.filter(r => r.status === '‚úÖ PASS').length;
                const failed = results.filter(r => r.status === '‚ùå FAIL').length;

                showResult('complete-crud-result', 
                    `<strong>üéØ Complete CRUD Test Results</strong><br><br>
                     <strong>‚úÖ Passed: ${passed}</strong><br>
                     <strong>‚ùå Failed: ${failed}</strong><br><br>
                     <strong>Detailed Results:</strong><br>
                     ${results.map(r => `${r.status} ${r.name}${r.error ? ' - ' + r.error : ''}`).join('<br>')}<br><br>
                     ${failed === 0 ? 
                         '<strong>üéâ All CRUD operations are working perfectly!</strong>' : 
                         '<strong>‚ö†Ô∏è Some operations failed. Check the individual test results above.</strong>'
                     }`, 
                    failed > 0, failed === 0);

            } catch (error) {
                showResult('complete-crud-result', 
                    `<strong>‚ùå Complete CRUD Test Failed!</strong><br>
                     Error: ${error.message}`, 
                    true);
            }
        }

        // Auto-test connection on page load
        window.addEventListener('load', () => {
            setTimeout(testConnection, 1000);
        });
    </script>
</body>
</html>
